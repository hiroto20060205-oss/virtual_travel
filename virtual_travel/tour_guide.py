#!/usr/bin/python3
# SPDX-FileCopyrightText: 2025 Fujitake Hiroto
# SPDX-License-Identifier: MIT

import rclpy
from rclpy.node import Node
from sensor_msgs.msg import NavSatFix
from geopy.distance import geodesic

class Listener(Node):
    def __init__(self):
        super().__init__('listener')
        self.sub = self.create_subscription(NavSatFix, 'gnss_fix', self.cb, 10)
        

        self.stations = [
            ("日本橋", 35.6835, 139.7713, "旅の始まり。五街道の起点。"),
            ("品川宿", 35.6209, 139.7402, "江戸四宿の一つ。遊興地として繁栄。"),
            ("川崎宿", 35.5323, 139.7042, "多摩川の六郷の渡しがある宿場。"),
            ("神奈川宿", 35.4741, 139.6300, "相模国や武蔵国多摩郡・三浦半島・房総半島方面との人や物資の経由地として栄えた。"),
            ("保土ヶ谷宿", 35.4452, 139.5960, "東海道では武蔵国最西端の宿場町。"),
            ("戸塚宿", 35.3954, 139.5298, "東海道では相模国最東端の宿場町。"),
            ("藤沢宿", 35.3448, 139.4886, "東海道五十三次整備以前から清浄光寺（遊行寺）の門前町として栄え、近くに江の島がある。"),
            ("平塚宿", 35.3275, 139.3330, "七番目の宿場。"),
            ("大磯宿", 35.3090, 139.3150, "現在は島崎藤村墓所がある。"),
            ("小田原宿", 35.2536, 139.1554, "江戸を出て最初の城下町にある宿場。かまぼこやういろうが有名。"),
            ("箱根宿", 35.1917, 139.0255, "五十三次の中で最も高い場所に位置する。"),
            ("三島宿", 35.1192, 138.9130, " 現在の静岡県三島市にあった。江戸幕府の天領。"),
            ("沼津宿", 35.1001, 138.8596, "十二番目の宿場。"),
            ("原宿", 35.1255, 138.7967, "帯笑園という庭園がある。"),
            ("吉原宿", 35.1627, 138.6847, "富士山の玄関先でもあった。また能の舞台の地として知られる。"),
            ("蒲原宿", 35.1172, 138.6041, "降雪の少ない東海地方であるが、東海道五十三次では雪景色で描かれており、1つの謎とされる。"),
            ("由比宿", 35.0935, 138.5563, "十六番目の宿場"),
            ("興津宿", 35.0506, 138.5205, "清見寺があり、風光明媚な場所。"),
            ("江尻宿", 35.0195, 138.4844, "清水港に近く、江戸への物流拠点となった。"),
            ("府中宿", 34.9715, 138.3828, "街は城下町である駿府の一角を成す。"),
            ("丸子宿", 34.9547, 138.3562, "とろろ汁が名物（丁子屋）。"),
            ("岡部宿", 34.9195, 138.2868, "旅籠・柏屋（かしばや）は、国の登録有形文化財に登録されている。"),
            ("藤枝宿", 34.8703, 138.2581, "田中城の城下町としての側面も持つ。"),
            ("島田宿", 34.8322, 138.1742, "「箱根八里は馬でも越すが 越すに越されぬ 大井川」と詠われた、東海道の難所の一つである。"),
            ("金谷宿", 34.8188, 138.1257, "大井川を渡った直後の宿場。増水で大井川の川越が禁止されると、旅客が足止めされ賑わった。"),
            ("日坂宿", 34.8055, 138.0773, "東海道の三大難所（峠）の一つとされる小夜の中山の西麓に位置する。"),
            ("掛川宿", 34.7733, 138.0145, "掛川城の城下町。山内一豊ゆかりの地。"),
            ("袋井宿", 34.7505, 137.9254, "東海道五十三次のちょうど真ん中（どまん中）の宿場。"),
            ("見付宿", 34.7176, 137.8546, "遠江国府が置かれた古くからの中心地。"),
            ("浜松宿", 34.7047, 137.7335, "浜松城の城下町。うなぎが名産。"),
            ("舞阪宿", 34.6833, 137.6083, "浜名湖（今切の渡し）を船で渡る前の宿場。"),
            ("新居宿", 34.6933, 137.5619, "今切の関所がある。浜名湖の西岸。"),
            ("白須賀宿", 34.6995, 137.5303, "津波被害を避けるため高台に移転した宿場。"),
            ("二川宿", 34.7247, 137.4262, "本陣・旅籠・商家が揃って現存する貴重な宿場。"),
            ("吉田宿", 34.7675, 137.3912, "現在の豊橋市。吉田城の城下町。手筒花火発祥。"),
            ("御油宿", 34.8341, 137.3160, "天然記念物の松並木が美しく残る。"),
            ("赤坂宿", 34.8553, 137.3069, "御油宿と非常に距離が近い（約1.7km）。"),
            ("藤川宿", 34.9133, 137.2307, "棒鼻（宿場の境界）が復元されている。"),
            ("岡崎宿", 34.9587, 137.1601, "徳川家康生誕の地、岡崎城の城下町。八丁味噌。"),
            ("池鯉鮒宿", 35.0039, 137.0392, "「ちりゅう」と読む。馬市で栄えた。"),
            ("鳴海宿", 35.0805, 136.9507, "絞り染め（有松・鳴海絞り）が有名。"),
            ("宮宿", 35.1271, 136.9080, "熱田神宮の門前町。七里の渡しの乗船場。ひつまぶし。"),
            ("桑名宿", 35.0664, 136.6974, "七里の渡しで到着する伊勢国の入口。焼き蛤が名物。"),
            ("四日市宿", 34.9658, 136.6264, "市場として栄えた。日永の追分で伊勢街道と分岐。"),
            ("石薬師宿", 34.8963, 136.5513, "石薬師寺の門前町。"),
            ("庄野宿", 34.8833, 136.5292, "広重の「白雨（夕立）」の浮世絵で世界的にも有名。"),
            ("亀山宿", 34.8519, 136.4542, "亀山城の城下町。雪景色が有名。"),
            ("関宿", 34.8517, 136.3934, "古い町並みが非常によく保存されている（重伝建）。"),
            ("坂下宿", 34.8913, 136.3533, "鈴鹿峠越えを控えた宿場。難所の一つ。"),
            ("土山宿", 34.9333, 136.2731, "鈴鹿峠を越えた近江最初の宿場。「坂は照る照る鈴鹿は曇る…」"),
            ("水口宿", 34.9655, 136.1683, "水口城の城下町。かんぴょうが名産。"),
            ("石部宿", 35.0064, 136.0542, "京立ちして最初の宿泊地になることが多かった。"),
            ("草津宿", 35.0189, 135.9622, "東海道と中山道の合流点。本陣が現存。"),
            ("大津宿", 35.0088, 135.8617, "琵琶湖畔の宿場。大津絵や走井餅が有名。"),
            ("三条大橋", 35.0054, 135.7697, "旅のゴール。京の都に到着。鴨川に架かる橋。")
        ]
        self.visited = [False] * len(self.stations)

    def cb(self, msg):
        for i, station in enumerate(self.stations):
            name, target_latitude, target_longitude, info = station

            latitude_difference = msg.latitude - target_latitude
            longitude_difference = msg.longitude - target_longitude

            if abs(latitude_difference) < 0.008 and abs(longitude_difference) < 0.008 and not self.visited[i]:
                self.get_logger().info(f"{name}に到着！(ガイド: {info})")
                self.visited[i] = True


def main():
    rclpy.init()
    node = Listener()
    rclpy.spin(node)
